{% extends "base.html" %}
{% block content %}
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if not active_tab %}active{% endif %}" id="qr-tab" data-bs-toggle="tab" data-bs-target="#qr" type="button">QR</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="call-tab" data-bs-toggle="tab" data-bs-target="#call" type="button">Llamar</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab=='sms' %}active{% endif %}" id="sms-tab" data-bs-toggle="tab" data-bs-target="#sms" type="button">Enviar SMS</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link {% if active_tab=='whatsapp' %}active{% endif %}" id="wa-tab" data-bs-toggle="tab" data-bs-target="#whatsapp" type="button">Enviar WhatsApp</button>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane fade {% if not active_tab %}show active{% endif %}" id="qr" role="tabpanel">
    <div class="d-flex justify-content-center align-items-center" style="min-height:200px;">
      <img src="{{ url_for('static', filename='qr.png') }}" alt="" class="img-fluid" style="max-width:320px;">
    </div>
  </div>

  <div class="tab-pane fade" id="call" role="tabpanel">
    <h5 class="mt-3">Llamada</h5>
    <p>Al pulsar el botón se abrirá la app de teléfono del usuario (la llamada no la realiza el servidor).</p>
    <a class="btn btn-primary" href="tel:{{ phone }}">Llamar {{ phone }}</a>
  </div>

  <div class="tab-pane fade {% if active_tab=='sms' %}show active{% endif %}" id="sms" role="tabpanel">
    <h5 class="mt-3">Formulario - SMS</h5>
    <form method="post" action="{{ url_for('submit') }}">
      <input type="hidden" name="method" value="sms">
      <div class="mb-3">
        <label class="form-label">Nombre</label>
        <input class="form-control" name="name" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Correo</label>
        <input class="form-control" type="email" name="email" required>
      </div>
      <button class="btn btn-success" type="submit">Enviar (simular y preparar SMS)</button>
    </form>
  </div>

  <div class="tab-pane fade {% if active_tab=='whatsapp' %}show active{% endif %}" id="whatsapp" role="tabpanel">
    <h5 class="mt-3">Formulario - WhatsApp</h5>
    <form method="post" action="{{ url_for('submit') }}">
      <input type="hidden" name="method" value="whatsapp">
      <div class="mb-3">
        <label class="form-label">Nombre</label>
        <input class="form-control" name="name" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Correo</label>
        <input class="form-control" type="email" name="email" required>
      </div>
      <button class="btn btn-success" type="submit">Enviar (simular y preparar WhatsApp)</button>
    </form>
  </div>
</div>

{% if preview_message %}
<hr>
<h5>Vista previa del mensaje (simulado)</h5>
<pre>{{ preview_message }}</pre>
<p class="small">Para <strong>enviar</strong> manualmente, pulsa uno de los enlaces (esto abre la app del usuario):</p>
<p>
  <a class="btn btn-outline-primary" href="{{ sms_link }}">Abrir SMS pre-llenado</a>
  <a class="btn btn-outline-success" href="{{ wa_link }}" target="_blank">Abrir WhatsApp pre-llenado</a>
</p>
{% endif %}
{% endblock %}
